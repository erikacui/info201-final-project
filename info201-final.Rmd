---
title: "info201-final"
author: "Erika Cui"
date: "2023-12-06"
output: html_document
---

```{r}
library(tidyverse)
library(readr)
library(dplyr)
library(ggplot2)
library(ggrepel)
```

Combine two data sets into one data frame. Clean and merge it.

```{r}
salePriceData <- read_delim("../data/Sale_Prices_State.csv")

salePrice <- salePriceData %>% 
  select(RegionName, `2020-02`) %>% 
  rename(states = RegionName, price = `2020-02`)
  salePrice
```
```{r}
countiesData <- read_delim("../data/counties_per_capita_income.csv")

pciData <- countiesData %>% 
  select(states, pci)
head(pciData)
```



```{r}
reData <- read_delim("../data/realtor-data.zip.csv.zip")

realEstate <- reData %>%
  rename(states = state, price = price) %>% 
  select(states, price) %>%
  filter(states != "Puerto Rico")

head(realEstate)
```

```{r}
realEstateAvg <- realEstate %>% 
  group_by(states) %>% 
  summarize(avg_price = mean(price)) %>% 
  filter(!is.na(avg_price))
realEstateAvg
```
```{r}
merge1 <- full_join(salePrice, realEstateAvg, by = "states")

merge1$avg_price[is.na(merge1$avg_price)] <- merge1$price[is.na(merge1$avg_price)]

merge1$avg_price[!is.na(merge1$price) & !is.na(merge1$avg_price)] <- 
  (merge1$price[!is.na(merge1$price) & !is.na(merge1$avg_price)] +
  merge1$avg_price[!is.na(merge1$price) & !is.na(merge1$avg_price)]) / 2

merge1 <- merge1 %>% 
  arrange(states) %>% 
  select(states, avg_price)

merge1
```


```{r}
merge2 <- left_join(pciData, merge1, by = "states")

merge2$pci <- as.numeric(gsub("[^0-9.]", "", merge2$pci))

merge2 <- merge2 %>% 
  group_by(states) %>% 
  summarize(avg_pci = mean(pci, na.rm = TRUE)) %>% 
  filter(states != "American Samoa") %>% 
  filter(states != "Puerto Rico") %>% 
  filter(states != "Guam") %>% 
  filter(states != "Northern Mariana Islands") %>% 
  filter(states != "U.S. Virgin Islands") %>% 
  filter(states != "Virgin Islands")

merge2

```

```{r}
merge3 <- full_join(merge1, merge2, by = "states")

merge3 <- merge3 %>% 
  filter(states != "Virgin Islands")

merge3
```

```{r}
merge3 %>% 
  ggplot(aes(x = avg_pci, y = avg_price, label = states)) +
  geom_point() +
  geom_text_repel(size = 3, force = 10) +
  scale_y_continuous(labels = scales::comma)
```

```{r}
top10 <- merge3 %>% 
  arrange(desc(avg_price)) %>% 
  slice(1:10)

ggplot(top10, (aes(x = reorder(states, -avg_price), y = avg_price))) +
  geom_bar(stat = "identity", fill = "purple2")+
  scale_y_continuous(labels = scales::comma) +
  coord_flip()
```
```{r}
top5 <- merge3 %>% 
  arrange(desc(avg_price)) %>% 
  slice(1:5)
```

```{r}
bot5 <- merge3 %>% 
  arrange(avg_price) %>% 
  slice(1:5)
```

```{r}
top5$group <- "Top 5"
bot5$group <- "Bottom 5"

mergeGroup <- rbind(top5, bot5)

ggplot(mergeGroup, aes(x = reorder(states, avg_price), y = avg_price, fill = group)) +
  geom_bar(stat = "identity", position = "dodge") +
  scale_fill_manual(values = c("Top 5" = "violetred", "Bottom 5" = "lightblue"), guide = FALSE) +
  scale_y_continuous(labels = scales::comma) +
  coord_flip() +
  theme(axis.text.y = element_text(size = 6))
```





Create additonal columns. One new categorical variable, one new continuos/numerical variable, one summarization data frame.
